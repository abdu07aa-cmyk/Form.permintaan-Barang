<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Permintaan Barang</title>  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f1f5f9;padding:16px}
    h2{margin-bottom:8px}
    .box{background:#fff;border-radius:10px;padding:12px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    label{font-size:13px;color:#334155}
    input,select,button{padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px}
    button{background:#2563eb;color:#fff;border:none;cursor:pointer}
    button:hover{opacity:.9}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #cbd5e1;padding:6px;font-size:13px;text-align:center}
    th{background:#e2e8f0}
    .filter{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
  </style></head>
<body><h2>Form Permintaan Barang</h2>
<div class="box">
  <table id="inputTable">
    <thead>
      <tr>
        <th>Tanggal</th><th>Brand</th><th>Line</th><th>OP</th>
        <th>Jenis</th><th>Size</th><th>Paper</th><th>Permintaan</th><th>Kirim</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="date"></td>
        <td><input></td>
        <td><select></select></td>
        <td><select></select></td>
        <td><select></select></td>
        <td><select></select></td>
        <td><select></select></td>
        <td><input type="number"></td>
        <td><input type="number"></td>
      </tr>
    </tbody>
  </table>
  <br>
  <button onclick="simpan()">Simpan</button>
</div><h2>Filter Data</h2>
<div class="box filter">
  <input type="date" id="fTanggal">
  <input id="fBrand" placeholder="Brand">
  <select id="fLine"></select>
  <select id="fOP"></select>
  <select id="fJenis"></select>
  <select id="fSize"></select>
  <select id="fPaper"></select>
  <button onclick="kirimWA()">Share WA</button>
</div><div class="box">
  <table id="dataTable">
    <thead>
      <tr>
        <th>Tanggal</th><th>Brand</th><th>Line</th><th>OP</th>
        <th>Jenis</th><th>Size</th><th>Paper</th><th>Permintaan</th><th>Kirim</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div><script>
const supabase = supabaseJs.createClient(
  'YOUR_SUPABASE_URL',
  'YOUR_SUPABASE_ANON_KEY'
);

const lineList=['LINE 1','LINE 2'];
const opList=['OP 1','OP 2'];
const jenisList=['FILTER','BOOKLET'];
const sizeList=['A4','A5'];
const paperList=['HVS','ART'];

const optFilter=a=>'<option value="">-- semua --</option>'+a.map(v=>`<option>${v}</option>`).join('');
const optInput=a=>'<option value="">-- pilih --</option>'+a.map(v=>`<option>${v}</option>`).join('');

// isi dropdown
['fLine','fOP','fJenis','fSize','fPaper'].forEach(id=>{
  const el=document.getElementById(id);
  if(id==='fLine') el.innerHTML=optFilter(lineList);
  if(id==='fOP') el.innerHTML=optFilter(opList);
  if(id==='fJenis') el.innerHTML=optFilter(jenisList);
  if(id==='fSize') el.innerHTML=optFilter(sizeList);
  if(id==='fPaper') el.innerHTML=optFilter(paperList);
});

const row=document.querySelector('#inputTable tbody tr').children;
row[2].children[0].innerHTML=optInput(lineList);
row[3].children[0].innerHTML=optInput(opList);
row[4].children[0].innerHTML=optInput(jenisList);
row[5].children[0].innerHTML=optInput(sizeList);
row[6].children[0].innerHTML=optInput(paperList);

const fmt=t=>new Date(t).toLocaleDateString('id-ID');

async function simpan(){
  const c=row;
  if(!c[0].children[0].value||!c[1].children[0].value) return alert('Tanggal & Brand wajib');

  await supabase.from('permintaan_barang').insert({
    tanggal:c[0].children[0].value,
    brand:c[1].children[0].value,
    line:c[2].children[0].value,
    op:c[3].children[0].value,
    jenis:c[4].children[0].value,
    size:c[5].children[0].value,
    paper:c[6].children[0].value,
    permintaan:c[7].children[0].value,
    kirim:c[8].children[0].value
  });
  loadData();
}

async function loadData(){
  let q=supabase.from('permintaan_barang').select('*').order('tanggal',{ascending:false});
  if(fTanggal.value) q=q.eq('tanggal',fTanggal.value);
  if(fBrand.value) q=q.ilike('brand','%'+fBrand.value+'%');
  if(fLine.value) q=q.eq('line',fLine.value);
  if(fOP.value) q=q.eq('op',fOP.value);
  if(fJenis.value) q=q.eq('jenis',fJenis.value);
  if(fSize.value) q=q.eq('size',fSize.value);
  if(fPaper.value) q=q.eq('paper',fPaper.value);

  const {data}=await q;
  const tb=dataTable.tBodies[0];tb.innerHTML='';
  data.forEach(d=>{
    tb.innerHTML+=`<tr>
      <td>${fmt(d.tanggal)}</td><td>${d.brand}</td><td>${d.line}</td><td>${d.op}</td>
      <td>${d.jenis}</td><td>${d.size}</td><td>${d.paper}</td>
      <td>${d.permintaan}</td><td>${d.kirim}</td>
    </tr>`;
  });
}

function kirimWA(){
  let pesan=`PERMINTAAN BARANG\nTanggal: ${fTanggal.value||'Semua'}\nBrand: ${fBrand.value||'Semua'}\n\n`;
  [...dataTable.tBodies[0].rows].forEach(r=>{
    const c=r.cells;
    pesan+=`${c[2].innerText} | ${c[4].innerText} | ${c[7].innerText}/${c[8].innerText}\n`;
  });
  window.open('https://api.whatsapp.com/send?text='+encodeURIComponent(pesan));
}

['fTanggal','fLine','fOP','fJenis','fSize','fPaper'].forEach(id=>document.getElementById(id).addEventListener('change',loadData));
fBrand.addEventListener('input',loadData);
loadData();
</script></body>
</html>
